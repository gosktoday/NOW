<!doctype html>
<html lang="is">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>NOW Foods – Dagleg vítamínráðgjöf</title>
  <style>
    :root{
      --bg:#0b1220;
      --card:#0f1a30;
      --muted:#9fb0d0;
      --text:#eaf0ff;
      --accent:#6aa6ff;
      --border:rgba(255,255,255,0.10);
      --good:#46d38a;
      --warn:#ffcf5a;
      --bad:#ff6b6b;
      --orange:#ff8a00;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Inter, Arial, sans-serif;
      background: radial-gradient(1200px 800px at 20% 0%, #14244a 0%, var(--bg) 60%);
      color:var(--text);
    }
    header{
      padding:28px 18px 12px;
      max-width:1100px; margin:0 auto;
    }
    h1{margin:0 0 6px; font-size:22px; letter-spacing:0.2px}
    .sub{color:var(--muted); font-size:13px; line-height:1.35}
    main{max-width:1100px; margin:0 auto; padding:12px 18px 40px;}
    .grid{display:grid; grid-template-columns: 1fr; gap:14px;}
    @media (min-width: 980px){
      .grid{ grid-template-columns: 420px 1fr; align-items:start; }
    }
    .card{
      background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02));
      border:1px solid var(--border);
      border-radius:18px;
      padding:16px;
      box-shadow: 0 12px 30px rgba(0,0,0,0.25);
    }
    .card h2{
      margin:0 0 10px;
      font-size:15px;
      letter-spacing:0.2px;
      color:#d9e6ff;
    }
    label{display:block; font-size:12px; color:var(--muted); margin:10px 0 6px;}
    input, select, button{
      width:100%;
      border-radius:12px;
      border:1px solid var(--border);
      background: rgba(0,0,0,0.18);
      color:var(--text);
      padding:10px 12px;
      font-size:14px;
      outline:none;
    }
    input::placeholder{color:rgba(234,240,255,0.45)}
    .row{display:grid; grid-template-columns: 1fr 1fr; gap:10px;}
    .checks{display:grid; gap:8px; margin-top:8px;}
    .check{
      display:flex; gap:10px; align-items:flex-start;
      padding:10px 12px; border-radius:14px;
      border:1px solid var(--border);
      background: rgba(0,0,0,0.14);
    }
    .check input{width:auto; margin-top:2px;}
    .check b{display:block; font-size:13px; margin-bottom:2px;}
    .check span{display:block; font-size:12px; color:var(--muted); line-height:1.3;}
    .actions{display:flex; gap:10px; margin-top:12px; flex-wrap:wrap;}
    button{
      cursor:pointer;
      background: linear-gradient(180deg, rgba(106,166,255,0.35), rgba(106,166,255,0.18));
      border:1px solid rgba(106,166,255,0.45);
    }
    button.secondary{
      background: rgba(0,0,0,0.18);
      border:1px solid var(--border);
    }
    .pill{
      display:inline-flex; align-items:center; gap:8px;
      padding:6px 10px; border-radius:999px;
      border:1px solid var(--border);
      background: rgba(0,0,0,0.16);
      color:var(--muted);
      font-size:12px;
    }
    .pill.good{color: #bff6d9; border-color: rgba(70,211,138,0.35); background: rgba(70,211,138,0.10);}
    .pill.warn{color: #ffe6a8; border-color: rgba(255,207,90,0.35); background: rgba(255,207,90,0.10);}
    .pill.bad{color: #ffd0d0; border-color: rgba(255,107,107,0.35); background: rgba(255,107,107,0.10);}
    .resultsTop{
      display:flex; justify-content:space-between; align-items:flex-start; gap:10px; flex-wrap:wrap;
      margin-bottom:10px;
    }
    .stack{display:grid; gap:10px; margin-top:10px;}
    .item{
      border:1px solid var(--border);
      border-radius:16px;
      padding:12px;
      background: rgba(0,0,0,0.14);
    }
    .item h3{margin:0; font-size:14px;}
    .meta{display:flex; gap:8px; flex-wrap:wrap; margin:6px 0;}
    .item p{margin:6px 0 0; color:var(--muted); font-size:12.5px; line-height:1.4;}
    a{color:#b7d2ff}
    .small{font-size:12px; color:var(--muted); line-height:1.4;}
    .hr{height:1px; background:var(--border); margin:12px 0;}

    /* NÝTT: vara + mynd + appelsínugult nafn */
    .titleRow{
      display:flex;
      align-items:center;
      gap:10px;
    }
    .prodImg{
      width:36px;
      height:36px;
      border-radius:10px;
      object-fit:cover;
      border:1px solid var(--border);
      background: rgba(0,0,0,0.12);
      flex:0 0 auto;
    }
    .prodName{
      color: var(--orange);
      font-weight: 700;
      letter-spacing: 0.1px;
    }

    /* Yfirlit (fyrir sýnilegt HTML) */
    #summaryPreview{
      border:1px solid var(--border);
      border-radius:16px;
      background: rgba(0,0,0,0.14);
      padding:12px;
    }
    #summaryPreview .line{margin:0 0 6px;}
    #summaryPreview .muted{color:var(--muted);}
    #summaryPreview ul{margin:8px 0 0; padding-left:18px;}
    #summaryPreview li{margin:6px 0;}
    .summaryItem{
      display:flex; align-items:center; gap:10px;
    }
    .summaryItem img{
      width:28px; height:28px; border-radius:9px; object-fit:cover;
      border:1px solid var(--border);
    }
    .hidden{display:none;}
  </style>
</head>
<body>
  <header>
    <h1>NOW Foods – Dagleg vítamínráðgjöf</h1>
    <div class="sub">
      Sláðu inn upplýsingar og fáðu einfalda daglega áætlun – <b>eingöngu NOW Foods</b> vörur (nowfoods.com).
      <br/>Ekki læknisráð. Athugaðu alltaf merkingar („Suggested Usage“) og ráðfærðu þig við heilbrigðisstarfsfólk ef þú ert þunguð/á lyfjum/eða með sjúkdóma.
    </div>
  </header>

  <main>
    <div class="grid">
      <section class="card">
        <h2>Grunnupplýsingar</h2>

        <div class="row">
          <div>
            <label for="sex">Kyn</label>
            <select id="sex">
              <option value="male">Karl</option>
              <option value="female">Kona</option>
            </select>
          </div>
          <div>
            <label for="age">Aldur</label>
            <input id="age" type="number" min="10" max="120" placeholder="t.d. 41" />
          </div>
        </div>

        <div class="row">
          <div>
            <label for="height">Hæð (cm)</label>
            <input id="height" type="number" min="120" max="230" placeholder="t.d. 190" />
          </div>
          <div>
            <label for="weight">Þyngd (kg)</label>
            <input id="weight" type="number" min="30" max="300" placeholder="t.d. 120" />
          </div>
        </div>

        <div class="row">
          <div>
            <label for="activity">Hreyfing</label>
            <select id="activity">
              <option value="low">Lítil (mest setið)</option>
              <option value="moderate" selected>Miðlungs</option>
              <option value="high">Mikil (mikil þjálfun / mikið gengið)</option>
            </select>
          </div>
          <div>
            <label for="diet">Mataræði</label>
            <select id="diet">
              <option value="mixed" selected>Blandað</option>
              <option value="vegetarian">Grænmetisfæði</option>
              <option value="vegan">Vegan</option>
            </select>
          </div>
        </div>

        <div class="checks">
          <div class="check">
            <input id="lowSun" type="checkbox" checked />
            <div>
              <b>Lítil sól</b>
              <span>Skrifstofa, vetrartími, hár breiddargráða, lítil UV útsetning o.s.frv.</span>
            </div>
          </div>

          <div class="check" id="pregRow" style="display:none;">
            <input id="pregnant" type="checkbox" />
            <div>
              <b>Þunguð / að reyna að verða þunguð</b>
              <span>Skiptir „grunn-multí“ yfir í meðgönguformúlu.</span>
            </div>
          </div>

          <div class="check">
            <input id="lowFish" type="checkbox" checked />
            <div>
              <b>Borða sjaldan feitan fisk</b>
              <span>Leggur til omega-3 (nema ef þú velur Vegan).</span>
            </div>
          </div>

          <div class="check">
            <input id="constipationSensitive" type="checkbox" />
            <div>
              <b>Viðkvæmur magi / bakflæði</b>
              <span>Reynir að velja „mildari“ form þegar við á.</span>
            </div>
          </div>

          <div class="check">
            <input id="knownLowIron" type="checkbox" />
            <div>
              <b>Staðfestur járnskortur (blóðprufa/læknir)</b>
              <span>Járn er aðeins lagt til ef þetta er hakað við.</span>
            </div>
          </div>
        </div>

        <div class="actions">
          <button id="btnGenerate">Búa til áætlun</button>
          <button id="btnSave" class="secondary">Vista innslátt</button>
          <button id="btnLoad" class="secondary">Hlaða vistuðu</button>
          <button id="btnClear" class="secondary">Hreinsa</button>
        </div>

        <div class="hr"></div>
        <div id="stats" class="small"></div>
      </section>

      <section class="card">
        <div class="resultsTop">
          <h2 style="margin:0;">Dagleg áætlun</h2>
          <div id="badgeRow" style="display:flex; gap:8px; flex-wrap:wrap;"></div>
        </div>

        <div id="results" class="small">
          Fylltu inn upplýsingar og smelltu á <b>Búa til áætlun</b>.
        </div>

        <div class="hr"></div>

        <h2>Yfirlit (með lit & myndum)</h2>
        <div id="summaryPreview" class="small">
          <div class="muted">Yfirlitið birtist hér þegar þú býrð til áætlun.</div>
        </div>

        <!-- Falið: hreint texta-yfirlit sem er notað fyrir “Copy” -->
        <textarea id="summaryText" class="hidden" readonly></textarea>

        <div class="actions" style="margin-top:12px;">
          <button id="btnCopy">Afrita yfirlit</button>
          <button id="btnOpenLinks" class="secondary">Opna vörusíður</button>
        </div>

        <div class="small" style="margin-top:10px;">
          Ábendingar:
          <ul>
            <li>Byrjaðu á <b>grunn-multí</b>, bættu svo við 1 vöru í einu (vika) til að meta þol.</li>
            <li>Fylgdu alltaf „Suggested Usage“ á NOW merkingum.</li>
            <li>Ef þú ert á lyfjum (t.d. blóðþynning, skjaldkirtilslyf o.fl.), skoðaðu milliverkanir.</li>
          </ul>
        </div>
      </section>
    </div>
  </main>

<script>
(function(){
  // NOW Foods vörur (eingöngu)
  // Myndir eru beinar NOW Foods myndir (nowfoods.com)
  const PRODUCTS = {
    adamTabs: {
      key: "adamTabs",
      name: "ADAM™ Men's Multiple Vitamin Tablets (NOW Foods)",
      url: "https://www.nowfoods.com/products/supplements/adam-mens-multiple-vitamin-tablets",
      img: "https://www.nowfoods.com/sites/default/files/styles/cloudzoom_thumbnail/public/2023-07/3875_mainimage.png?itok=ankcl2br",
      tags: ["Grunn-multí", "Karl"],
      dose_is: "Fylgdu „Suggested Usage“ á merkingu. Tekið með mat.",
      why_is: "Grunn daglegt fjölvítamín fyrir karla."
    },
    eveSoftgels: {
      key: "eveSoftgels",
      name: "EVE™ Women's Multiple Vitamin Softgels (NOW Foods)",
      url: "https://www.nowfoods.com/products/supplements/eve-womens-multiple-vitamin-softgels",
      img: "https://www.nowfoods.com/sites/default/files/styles/cloudzoom_image/public/2026-01/3802_v12.png?itok=c3SUqw-G",
      tags: ["Grunn-multí", "Kona"],
      dose_is: "Fylgdu „Suggested Usage“ á merkingu. Tekið með mat.",
      why_is: "Grunn daglegt fjölvítamín fyrir konur (softgels geta verið auðveldari fyrir maga)."
    },
    eveTabs: {
      key: "eveTabs",
      name: "EVE™ Women's Multiple Vitamin Tablets (NOW Foods)",
      url: "https://www.nowfoods.com/products/supplements/eve-womens-multiple-vitamin-tablets",
      img: "https://www.nowfoods.com/sites/default/files/styles/cloudzoom_image/public/2025-04/3796_v17.png?itok=x1elqJeF",
      tags: ["Grunn-multí", "Kona"],
      dose_is: "Fylgdu „Suggested Usage“ á merkingu. Tekið með mat.",
      why_is: "Grunn daglegt fjölvítamín fyrir konur."
    },
    prenatal: {
      key: "prenatal",
      name: "Prenatal Gels + DHA Softgels (NOW Foods)",
      url: "https://www.nowfoods.com/products/supplements/prenatal-gels-dha-softgels",
      img: "https://www.nowfoods.com/sites/default/files/styles/cloudzoom_thumbnail/public/2024-12/3809_v8_Right.png?itok=HcdEMZJQ",
      tags: ["Grunn-multí", "Meðganga"],
      dose_is: "Fylgdu „Suggested Usage“ á merkingu. Tekið með mat.",
      why_is: "Hannað fyrir meðgöngu/að reyna að verða þunguð og inniheldur DHA."
    },
    d3_2000: {
      key: "d3_2000",
      name: "Vitamin D-3 2000 IU Softgels (NOW Foods)",
      url: "https://www.nowfoods.com/products/supplements/vitamin-d3-2000-iu-softgels",
      img: "https://www.nowfoods.com/sites/default/files/styles/cloudzoom_image/public/2025-09/0355_v4.png?itok=wfrfeh0H",
      tags: ["D-vítamín"],
      dose_is: "Algengt er 1 á dag með máltíð (en fylgdu alltaf merkingu).",
      why_is: "Algeng viðbót þegar sól er lítil."
    },
    ultraOmega3: {
      key: "ultraOmega3",
      name: "Ultra Omega-3 Softgels (NOW Foods)",
      url: "https://www.nowfoods.com/products/supplements/ultra-omega-3-fish-oil-bovine-gelatin-softgels",
      img: "https://www.nowfoods.com/sites/default/files/styles/cloudzoom_image/public/2023-04/1661_mainimage.png?itok=PoVZOpUg",
      tags: ["Omega-3"],
      dose_is: "Fylgdu „Suggested Usage“. Tekið með mat.",
      why_is: "Omega-3, sérstaklega ef þú borðar sjaldan feitan fisk."
    },
    magGly: {
      key: "magGly",
      name: "Magnesium Glycinate Tablets (NOW Foods)",
      url: "https://www.nowfoods.com/products/supplements/magnesium-glycinate-tablets",
      img: "https://www.nowfoods.com/sites/default/files/styles/cloudzoom_thumbnail/public/2025-10/1286_1.png?itok=CFbDxXJz",
      tags: ["Magnesíum"],
      dose_is: "Oft tekið á kvöldin; fylgdu merkingu.",
      why_is: "Magnesíum stuðningur (glycinate er oft valið fyrir þol)."
    },
    probiotic10_25: {
      key: "probiotic10_25",
      name: "Probiotic-10™ 25 Billion Veg Capsules (NOW Foods)",
      url: "https://www.nowfoods.com/products/supplements/probiotic-10-25-billion-veg-capsules",
      img: "https://www.nowfoods.com/sites/default/files/styles/cloudzoom_image/public/2025-07/2937_v6.png?itok=MFv5ow0A",
      tags: ["Probiotics"],
      dose_is: "Fylgdu merkingu. Byrjaðu varlega ef viðkvæmur magi.",
      why_is: "Valfrjáls stuðningur fyrir meltingu/flóru."
    },
    b12_1000: {
      key: "b12_1000",
      name: "Vitamin B-12 1000 mcg Lozenges (NOW Foods)",
      url: "https://www.nowfoods.com/products/supplements/vitamin-b-12-1000-mcg-lozenges",
      img: "https://www.nowfoods.com/sites/default/files/styles/cloudzoom_thumbnail/public/2025-01/0466_v6.png?itok=V1kx0U4J",
      tags: ["B-12"],
      dose_is: "Fylgdu merkingu. Sérstaklega mikilvægt við vegan/grænmetisfæði.",
      why_is: "Sérstaklega viðeigandi ef mataræði er lítið í dýraafurðum."
    },
    iron18: {
      key: "iron18",
      name: "Iron 18 mg Veg Capsules (NOW Foods)",
      url: "https://www.nowfoods.com/products/supplements/iron-18-mg-veg-capsules",
      img: "https://www.nowfoods.com/sites/default/files/styles/cloudzoom_thumbnail/public/2024-10/1443_v7.png?itok=yAkmfiCH",
      tags: ["Járn"],
      dose_is: "Aðeins ef læknir/blóðprufur mæla með. Fylgdu merkingu og ráðgjöf.",
      why_is: "Járn er ekki fyrir alla — aðeins lagt til ef staðfestur skortur er til staðar."
    }
  };

  const $ = (id) => document.getElementById(id);

  const sex = $("sex");
  const age = $("age");
  const height = $("height");
  const weight = $("weight");
  const activity = $("activity");
  const diet = $("diet");
  const lowSun = $("lowSun");
  const pregnant = $("pregnant");
  const lowFish = $("lowFish");
  const constipationSensitive = $("constipationSensitive");
  const knownLowIron = $("knownLowIron");
  const pregRow = $("pregRow");

  function syncPregVisibility(){
    pregRow.style.display = (sex.value === "female") ? "flex" : "none";
    if(sex.value !== "female") pregnant.checked = false;
  }
  sex.addEventListener("change", syncPregVisibility);
  syncPregVisibility();

  function bmiFrom(cm, kg){
    if(!cm || !kg) return null;
    const m = cm / 100;
    if(m <= 0) return null;
    return kg / (m*m);
  }

  function bmiBadge(bmi){
    if(bmi == null) return null;
    if(bmi < 18.5) return {label:`BMI ${bmi.toFixed(1)} (undirþyngd)`, cls:"warn"};
    if(bmi < 25) return {label:`BMI ${bmi.toFixed(1)} (eðlilegt)`, cls:"good"};
    if(bmi < 30) return {label:`BMI ${bmi.toFixed(1)} (yfirþyngd)`, cls:"warn"};
    return {label:`BMI ${bmi.toFixed(1)} (offita-svið)`, cls:"warn"};
  }

  function renderPills(pills){
    const row = $("badgeRow");
    row.innerHTML = "";
    pills.filter(Boolean).forEach(p => {
      const el = document.createElement("span");
      el.className = `pill ${p.cls || ""}`.trim();
      el.textContent = p.label;
      row.appendChild(el);
    });
  }

  function pickBaseMulti(inputs){
    const { sex, pregnant, constipationSensitive } = inputs;

    if(sex === "female" && pregnant){
      return PRODUCTS.prenatal;
    }
    if(sex === "female"){
      return constipationSensitive ? PRODUCTS.eveSoftgels : PRODUCTS.eveTabs;
    }
    return PRODUCTS.adamTabs;
  }

  function recommend(inputs){
    const stack = [];
    const notes = [];

    // Grunn multí
    const base = pickBaseMulti(inputs);
    stack.push({
      product: base,
      priority: 1,
      timing_is: "Morgunn / með mat"
    });

    // D-vítamín
    if(inputs.lowSun){
      stack.push({
        product: PRODUCTS.d3_2000,
        priority: 2,
        timing_is: "Með máltíð (oft morgunmatur eða hádegismatur)"
      });
    }

    // Omega-3 ef lítið af feitum fiski
    if(inputs.lowFish){
      if(inputs.diet === "vegan"){
        notes.push("Þú valdir Vegan: appið leggur ekki til fiskiolíu. Ef þú vilt omega-stuðning, skoðaðu plöntuvalkosti á nowfoods.com.");
      } else {
        stack.push({
          product: PRODUCTS.ultraOmega3,
          priority: 3,
          timing_is: "Með mat (oft hádegis- eða kvöldmatur)"
        });
      }
    }

    // Magnesíum (sterkara ef miðlungs/mikil hreyfing)
    if(inputs.activity === "high" || inputs.activity === "moderate"){
      stack.push({
        product: PRODUCTS.magGly,
        priority: 4,
        timing_is: "Kvöld"
      });
    }

    // Probiotics (valfrjálst, tengt við “viðkvæmur magi” hér)
    if(inputs.constipationSensitive){
      stack.push({
        product: PRODUCTS.probiotic10_25,
        priority: 5,
        timing_is: "Samkvæmt merkingu (margir taka á fastandi maga)"
      });
    }

    // B-12 (vegan/vegetarian)
    if(inputs.diet === "vegan" || inputs.diet === "vegetarian"){
      stack.push({
        product: PRODUCTS.b12_1000,
        priority: 3,
        timing_is: "Morgunn (eða hvenær sem er); samkvæmt merkingu"
      });
    }

    // Járn (aðeins ef hakað við)
    if(inputs.knownLowIron){
      stack.push({
        product: PRODUCTS.iron18,
        priority: 2,
        timing_is: "Samkvæmt lækni/merkingu; forðastu með kaffi/kalsíum ef ráðlagt"
      });
      notes.push("Járn getur verið skaðlegt ef þú þarft það ekki. Best að styðjast við blóðprufur og ráðgjöf.");
    }

    // Dedupe
    const uniq = [];
    const seen = new Set();
    for(const s of stack.sort((a,b)=>a.priority-b.priority)){
      if(seen.has(s.product.url)) continue;
      seen.add(s.product.url);
      uniq.push(s);
    }

    notes.push("Fylgdu alltaf „Suggested Usage“ á NOW merkingum og ráðfærðu þig við heilbrigðisstarfsfólk ef þú ert þunguð/á lyfjum/eða með sjúkdóma.");

    return { stack: uniq, notes };
  }

  function toInputs(){
    return {
      sex: sex.value,
      age: Number(age.value || 0),
      height: Number(height.value || 0),
      weight: Number(weight.value || 0),
      activity: activity.value,
      diet: diet.value,
      lowSun: !!lowSun.checked,
      pregnant: !!pregnant.checked,
      lowFish: !!lowFish.checked,
      constipationSensitive: !!constipationSensitive.checked,
      knownLowIron: !!knownLowIron.checked
    };
  }

  function render(){
    const inputs = toInputs();

    const bmi = bmiFrom(inputs.height, inputs.weight);
    const pills = [];
    const b = bmiBadge(bmi);
    if(b) pills.push(b);
    if(inputs.lowSun) pills.push({label:"Lítil sól: D-3 lagt til", cls:"good"});
    if(inputs.diet === "vegan") pills.push({label:"Vegan", cls:"warn"});
    if(inputs.diet === "vegetarian") pills.push({label:"Grænmetisfæði", cls:"good"});
    if(inputs.pregnant) pills.push({label:"Meðgöngu-stilling", cls:"warn"});
    renderPills(pills);

    $("stats").innerHTML = `
      <div class="small">
        ${bmi ? `Reiknað BMI: <b>${bmi.toFixed(1)}</b>` : `Settu inn hæð + þyngd til að reikna BMI.`}
      </div>
    `;

    const { stack, notes } = recommend(inputs);

    const res = $("results");
    res.innerHTML = "";

    if(!inputs.age || !inputs.height || !inputs.weight){
      const tip = document.createElement("div");
      tip.className = "small";
      tip.innerHTML = `<span class="pill warn">Ábending</span> Settu inn aldur, hæð og þyngd fyrir betra yfirlit (BMI og merki).`;
      res.appendChild(tip);
    }

    const wrap = document.createElement("div");
    wrap.className = "stack";

    stack.forEach(entry => {
      const d = document.createElement("div");
      d.className = "item";

      const titleRow = document.createElement("div");
      titleRow.className = "titleRow";

      const img = document.createElement("img");
      img.className = "prodImg";
      img.src = entry.product.img;
      img.alt = entry.product.name;
      img.loading = "lazy";

      const h = document.createElement("h3");
      h.innerHTML = `<span class="prodName">${escapeHtml(entry.product.name)}</span>`;

      titleRow.appendChild(img);
      titleRow.appendChild(h);

      const meta = document.createElement("div");
      meta.className = "meta";
      entry.product.tags.forEach(t => {
        const p = document.createElement("span");
        p.className = "pill";
        p.textContent = t;
        meta.appendChild(p);
      });

      const timing = document.createElement("div");
      timing.className = "small";
      timing.innerHTML = `<span class="pill good">Tímasetning</span> ${escapeHtml(entry.timing_is)}`;

      const p1 = document.createElement("p");
      p1.innerHTML = `<b>Af hverju:</b> ${escapeHtml(entry.product.why_is)}`;

      const p2 = document.createElement("p");
      p2.innerHTML = `<b>Hvernig á að taka:</b> ${escapeHtml(entry.product.dose_is)}`;

      const p3 = document.createElement("p");
      p3.innerHTML = `<b>Vörusíða:</b> <a href="${entry.product.url}" target="_blank" rel="noopener">Opna á nowfoods.com</a>`;

      d.appendChild(titleRow);
      d.appendChild(meta);
      d.appendChild(timing);
      d.appendChild(p1);
      d.appendChild(p2);
      d.appendChild(p3);

      wrap.appendChild(d);
    });

    const noteBox = document.createElement("div");
    noteBox.className = "item";
    noteBox.innerHTML = `
      <h3>Athugasemdir & varúð</h3>
      <ul class="small" style="margin:6px 0 0; padding-left:18px;">
        ${notes.map(n => `<li>${escapeHtml(n)}</li>`).join("")}
      </ul>
    `;

    res.appendChild(wrap);
    res.appendChild(document.createElement("div")).className = "hr";
    res.appendChild(noteBox);

    // --- YFIRLIT: SÝNILEGT (með lit + myndum) ---
    const preview = $("summaryPreview");
    preview.innerHTML = "";

    const top = document.createElement("div");
    top.className = "line";
    top.innerHTML = `<b>NOW Foods – Dagleg áætlun</b>`;
    preview.appendChild(top);

    const line1 = document.createElement("div");
    line1.className = "line muted";
    line1.textContent = `Kyn: ${inputs.sex === "male" ? "Karl" : "Kona"} · Aldur: ${inputs.age || "?"} · Mataræði: ${dietLabel(inputs.diet)} · Hreyfing: ${activityLabel(inputs.activity)}`;
    preview.appendChild(line1);

    if(inputs.height && inputs.weight && bmi){
      const line2 = document.createElement("div");
      line2.className = "line muted";
      line2.textContent = `Hæð/Þyngd: ${inputs.height} cm / ${inputs.weight} kg (BMI ${bmi.toFixed(1)})`;
      preview.appendChild(line2);
    }

    const hr = document.createElement("div");
    hr.className = "hr";
    preview.appendChild(hr);

    const supTitle = document.createElement("div");
    supTitle.className = "line";
    supTitle.innerHTML = `<b>Vörur</b>`;
    preview.appendChild(supTitle);

    const ul = document.createElement("ul");
    ul.className = "small";

    stack.forEach((s) => {
      const li = document.createElement("li");

      const row = document.createElement("div");
      row.className = "summaryItem";

      const img = document.createElement("img");
      img.src = s.product.img;
      img.alt = s.product.name;
      img.loading = "lazy";

      const text = document.createElement("div");
      text.innerHTML = `
        <div><span class="prodName">${escapeHtml(s.product.name)}</span></div>
        <div class="muted">Tímasetning: ${escapeHtml(s.timing_is)}</div>
      `;

      row.appendChild(img);
      row.appendChild(text);
      li.appendChild(row);
      ul.appendChild(li);
    });
    preview.appendChild(ul);

    const hr2 = document.createElement("div");
    hr2.className = "hr";
    preview.appendChild(hr2);

    const noteTitle = document.createElement("div");
    noteTitle.className = "line";
    noteTitle.innerHTML = `<b>Athugasemdir</b>`;
    preview.appendChild(noteTitle);

    const ul2 = document.createElement("ul");
    ul2.className = "small";
    notes.forEach(n => {
      const li = document.createElement("li");
      li.textContent = n;
      ul2.appendChild(li);
    });
    preview.appendChild(ul2);

    // --- TEXTA-YFIRLIT: FYRIR AFTRITUN ---
    const lines = [];
    lines.push(`NOW Foods – Dagleg áætlun`);
    lines.push(`- Kyn: ${inputs.sex === "male" ? "Karl" : "Kona"}, Aldur: ${inputs.age || "?"}`);
    if(inputs.height && inputs.weight && bmi) lines.push(`- Hæð/Þyngd: ${inputs.height} cm / ${inputs.weight} kg (BMI ${bmi.toFixed(1)})`);
    lines.push(`- Mataræði: ${dietLabel(inputs.diet)}, Hreyfing: ${activityLabel(inputs.activity)}`);
    lines.push(``);
    lines.push(`Vörur:`);
    stack.forEach((s, idx) => {
      lines.push(`${idx+1}. ${s.product.name}`);
      lines.push(`   • Tímasetning: ${s.timing_is}`);
      lines.push(`   • Af hverju: ${s.product.why_is}`);
      lines.push(`   • Hvernig: ${s.product.dose_is}`);
      lines.push(`   • Link: ${s.product.url}`);
      lines.push(``);
    });
    lines.push(`Athugasemdir:`);
    notes.forEach(n => lines.push(`- ${n}`));
    $("summaryText").value = lines.join("\n");

    window.__lastLinks = stack.map(s => s.product.url);
  }

  function dietLabel(v){
    if(v === "vegan") return "Vegan";
    if(v === "vegetarian") return "Grænmetisfæði";
    return "Blandað";
  }
  function activityLabel(v){
    if(v === "low") return "Lítil";
    if(v === "high") return "Mikil";
    return "Miðlungs";
  }

  function escapeHtml(str){
    return String(str)
      .replaceAll("&","&amp;")
      .replaceAll("<","&lt;")
      .replaceAll(">","&gt;")
      .replaceAll('"',"&quot;")
      .replaceAll("'","&#039;");
  }

  // Storage
  const KEY = "nowVitaminRecommenderInputs_v2_is";
  function save(){
    localStorage.setItem(KEY, JSON.stringify(toInputs()));
  }
  function load(){
    const raw = localStorage.getItem(KEY);
    if(!raw) return;
    const v = JSON.parse(raw);
    sex.value = v.sex || "male";
    syncPregVisibility();
    age.value = v.age || "";
    height.value = v.height || "";
    weight.value = v.weight || "";
    activity.value = v.activity || "moderate";
    diet.value = v.diet || "mixed";
    lowSun.checked = !!v.lowSun;
    pregnant.checked = !!v.pregnant;
    lowFish.checked = !!v.lowFish;
    constipationSensitive.checked = !!v.constipationSensitive;
    knownLowIron.checked = !!v.knownLowIron;
  }
  function clearAll(){
    localStorage.removeItem(KEY);
    age.value = "";
    height.value = "";
    weight.value = "";
    activity.value = "moderate";
    diet.value = "mixed";
    lowSun.checked = true;
    pregnant.checked = false;
    lowFish.checked = true;
    constipationSensitive.checked = false;
    knownLowIron.checked = false;
    sex.value = "male";
    syncPregVisibility();
    $("results").innerHTML = `Fylltu inn upplýsingar og smelltu á <b>Búa til áætlun</b>.`;
    $("summaryPreview").innerHTML = `<div class="muted">Yfirlitið birtist hér þegar þú býrð til áætlun.</div>`;
    $("summaryText").value = "";
    $("badgeRow").innerHTML = "";
    $("stats").innerHTML = "";
  }

  // Buttons
  $("btnGenerate").addEventListener("click", render);
  $("btnSave").addEventListener("click", () => { save(); render(); });
  $("btnLoad").addEventListener("click", () => { load(); render(); });
  $("btnClear").addEventListener("click", clearAll);

  $("btnCopy").addEventListener("click", async () => {
    const txt = $("summaryText").value || "";
    if(!txt.trim()) return alert("Búðu til áætlun fyrst.");
    try{
      await navigator.clipboard.writeText(txt);
      alert("Yfirlit afritað!");
    }catch(e){
      // Fallback
      const ta = $("summaryText");
      ta.classList.remove("hidden");
      ta.focus();
      ta.select();
      document.execCommand("copy");
      ta.classList.add("hidden");
      alert("Yfirlit afritað (fallback)!");
    }
  });

  $("btnOpenLinks").addEventListener("click", () => {
    const links = window.__lastLinks || [];
    if(!links.length) return alert("Búðu til áætlun fyrst.");
    links.forEach(u => window.open(u, "_blank", "noopener"));
  });

  // Auto-load saved inputs if present
  load();
})();
</script>
</body>
</html>
